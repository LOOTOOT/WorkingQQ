<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>付QQ的最终幻想</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind Config for Custom Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bgMain: '#FFFBF8',
                        bgSec: '#FFCCB6',
                        highlight: '#D8F878',
                        wxGreen: '#95EC69',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans SC"', '-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'sans-serif'],
                    },
                    animation: {
                        'breathe': 'breathe 3s ease-in-out infinite',
                        'ripple': 'ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite',
                        'reveal': 'revealText 1.5s cubic-bezier(0.22, 1, 0.36, 1) forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    },
                    keyframes: {
                        breathe: {
                            '0%, 100%': { opacity: '0.6', transform: 'scale(1)' },
                            '50%': { opacity: '1', transform: 'scale(1.05)' },
                        },
                        ripple: {
                            '0%': { transform: 'scale(0.9)', opacity: '1' },
                            '100%': { transform: 'scale(2)', opacity: '0' },
                        },
                        revealText: {
                            '0%': { opacity: '0', clipPath: 'inset(0 50% 0 50%)' },
                            '100%': { opacity: '1', clipPath: 'inset(0 0 0 0)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700;900&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js"></script>

    <style>
        /* 全局样式覆盖 */
        body {
            background-color: #FFFBF8;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden; /* 防止滚动，像APP一样 */
        }

        /* 隐藏滚动条 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 玻璃拟态 */
        .glass-panel {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* 微信对话气泡 */
        .wx-bubble-left {
            position: relative;
        }
        .wx-bubble-left::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 14px;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 6px solid white;
        }
        .wx-bubble-right {
            position: relative;
        }
        .wx-bubble-right::before {
            content: '';
            position: absolute;
            right: -6px;
            top: 14px;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 6px solid #95EC69;
        }

        /* 登录页波纹特效 */
        .login-ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            pointer-events: none;
            animation: loginRippleAnim 1s ease-out forwards;
        }

        @keyframes loginRippleAnim {
            to {
                transform: scale(40); /* 覆盖整个屏幕 */
                opacity: 0;
            }
        }
    </style>
</head>

<body x-data="gameData()" x-init="preloadImages()" class="text-gray-800 font-sans h-screen w-screen relative overflow-hidden selection:bg-highlight">

    <!-- 背景音乐 -->
    <audio id="bgm" loop>
        <source src="https://cdn.jsdelivr.net/gh/LOOTOOT/WorkingQQ@main/HappyBirthdaySong.mp3" type="audio/mpeg">
    </audio>

    <!-- 1. 登录页面 (仿PS5) -->
    <section x-show="scene === 'login'" x-transition:leave="transition ease-in duration-1000" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-gradient-to-br from-gray-900 to-black text-white">

        <div class="relative z-10 flex flex-col items-center">
            <!-- 提示字 -->
            <div x-show="!loginClicked" x-transition:enter="transition ease-out duration-1000" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0" class="mb-8 text-xl font-light tracking-widest opacity-80 animate-pulse">
                请登录
            </div>

            <!-- 头像容器 -->
            <div @click="handleLogin($event)" class="relative group cursor-pointer transition-transform duration-300 hover:scale-110">
                <!-- 呼吸光环 -->
                <div class="absolute -inset-4 bg-white/20 rounded-full blur-xl animate-pulse group-hover:bg-highlight/40 transition-colors"></div>
                <!-- 头像 -->
                <img :src="imgUrl('fqq-avtar.jpg')" class="w-24 h-24 rounded-full border-2 border-white/50 object-cover relative z-10 shadow-[0_0_30px_rgba(255,255,255,0.3)]">
                <!-- 边缘闪光 -->
                <div x-show="loginClicked" class="absolute inset-0 rounded-full box-border border-4 border-white animate-ping"></div>
            </div>

            <div x-show="loginSuccess" x-transition:enter="transition ease-out duration-500 delay-300" x-transition:enter-start="opacity-0 scale-90" x-transition:enter-end="opacity-100 scale-100" class="mt-8 text-2xl font-bold tracking-widest text-highlight">
                登入成功
            </div>
        </div>

        <!-- 波纹容器 -->
        <div id="ripple-container" class="absolute inset-0 pointer-events-none overflow-hidden flex items-center justify-center"></div>
    </section>

    <!-- 2. 游戏主页 START SCREEN -->
    <section x-show="scene === 'start'" class="absolute inset-0 z-40 bg-bgMain">
        <!-- 背景图 -->
        <div class="absolute inset-0">
             <img :src="imgUrl('mainpage.jpg')" class="w-full h-full object-cover opacity-90">
             <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
        </div>

        <!-- 呼吸文字 -->
        <div @click="startGame()" class="absolute inset-x-0 bottom-1/4 h-32 flex items-center justify-center cursor-pointer z-50">
            <p class="text-white text-lg tracking-[0.2em] font-light animate-breathe drop-shadow-md">
                点击任意地方开始做梦
            </p>
        </div>
    </section>

    <!-- 3. VN 故事引擎 -->
    <section x-show="isGameScene" class="absolute inset-0 z-30 bg-bgMain flex flex-col">

        <!-- 顶部图片区域 (响应式高度) -->
        <div class="relative flex-grow w-full overflow-hidden bg-gray-100 transition-all duration-700" :class="{'h-full': !dialogue.options, 'h-3/5': dialogue.options}">
            <template x-if="dialogue.image">
                <img :src="imgUrl(dialogue.image)"
                     class="w-full h-full object-cover transition-opacity duration-1000"
                     :class="shakeEffect ? 'animate-shake' : ''"
                     alt="Scene Image">
            </template>
            <!-- 震动时的特效遮罩 -->
            <div x-show="shakeEffect" class="absolute inset-0 bg-red-500/10 mix-blend-overlay"></div>
        </div>

        <!-- 底部对话框区域 -->
        <div class="absolute bottom-0 left-0 right-0 p-6 pb-12 glass-panel rounded-t-3xl min-h-[30vh] flex flex-col justify-between shadow-[0_-10px_40px_rgba(0,0,0,0.05)] transition-all duration-500">

            <!-- 文字显示区 -->
            <div @click="nextText()" class="flex-grow cursor-pointer" :class="{'pointer-events-none': dialogue.options}">
                <!-- 名字 (可选) -->
                <template x-if="dialogue.speaker">
                    <div class="text-sm font-bold text-gray-400 mb-2 uppercase tracking-wide" x-text="dialogue.speaker"></div>
                </template>

                <!-- 对话内容 (带扩散特效) -->
                <div class="relative min-h-[80px] flex items-center justify-center">
                    <p :key="dialogue.text"
                       class="text-xl md:text-2xl font-medium text-center leading-relaxed text-gray-800 animate-reveal w-full"
                       :class="dialogue.isBig ? 'text-3xl font-black text-red-500' : ''"
                       x-html="dialogue.text">
                    </p>
                </div>

                <!-- 点击提示 -->
                <div x-show="!dialogue.options" class="w-full flex justify-center mt-4 opacity-50 animate-bounce">
                    <i class="fas fa-chevron-down text-gray-400"></i>
                </div>
            </div>

            <!-- 选项区域 -->
            <div x-show="dialogue.options" class="flex flex-col gap-3 mt-4 animate-fade-in-up">
                <template x-for="(opt, index) in dialogue.options">
                    <button @click="makeChoice(opt.next)"
                            class="w-full py-4 px-6 bg-white/80 hover:bg-highlight border border-gray-100 rounded-xl shadow-sm text-left text-gray-800 font-medium transition-all duration-200 transform hover:scale-[1.02] active:scale-95 flex items-center justify-between group">
                        <span x-text="opt.text"></span>
                        <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity text-gray-600"></i>
                    </button>
                </template>
            </div>
        </div>
    </section>

    <!-- 4. 微信聊天模拟器 -->
    <section x-show="scene === 'wechat'" class="absolute inset-0 z-30 bg-[#EDEDED] flex flex-col">
        <!-- 微信顶部 -->
        <div class="bg-[#EDEDED] px-4 py-3 flex items-center justify-between border-b border-gray-300 shadow-sm z-10 pt-safe-top">
            <div class="flex items-center gap-1 text-gray-800">
                <i class="fas fa-chevron-left text-lg"></i>
                <span class="text-lg">微信(1)</span>
            </div>
            <div class="font-semibold text-lg">钥匙老师 (CPU版)</div>
            <i class="fas fa-ellipsis-h text-gray-800"></i>
        </div>

        <!-- 聊天内容区域 -->
        <div class="flex-grow p-4 overflow-y-auto no-scrollbar flex flex-col gap-4" id="chat-container">
            <template x-for="msg in chatHistory">
                <!-- 消息行 -->
                <div class="flex w-full mb-2 animate-fade-in-up" :class="msg.isMe ? 'flex-row-reverse' : 'flex-row'">
                    <!-- 头像 -->
                    <img :src="imgUrl(msg.isMe ? 'fqq-avtar.jpg' : 'img-left.jpg')" class="w-10 h-10 rounded-md shadow-sm border border-gray-200 object-cover flex-shrink-0">

                    <!-- 气泡 -->
                    <div class="max-w-[70%] text-[15px] leading-snug py-2 px-3 rounded-md shadow-sm mx-3 break-words relative"
                         :class="msg.isMe ? 'bg-wxGreen text-black wx-bubble-right' : 'bg-white text-gray-800 wx-bubble-left'">
                        <span x-text="msg.text"></span>
                    </div>
                </div>
            </template>

            <!-- 系统提示 (撤回等) -->
            <template x-if="chatSystemMsg">
                <div class="text-center text-xs text-gray-400 my-2 animate-pulse" x-text="chatSystemMsg"></div>
            </template>
        </div>

        <!-- 聊天选项底栏 -->
        <div class="p-4 bg-[#F7F7F7] border-t border-gray-300 pb-safe-bottom">
            <template x-if="chatOptions">
                <div class="flex flex-col gap-2">
                    <template x-for="opt in chatOptions">
                        <button @click="handleChatOption(opt)" class="w-full py-3 bg-white border border-gray-200 rounded-lg text-gray-800 font-medium shadow-sm active:bg-gray-100 transition-colors">
                            <span x-text="opt.text"></span>
                        </button>
                    </template>
                </div>
            </template>
            <template x-if="!chatOptions">
                 <div class="h-12 bg-white rounded border border-gray-200 flex items-center px-4 text-gray-400 text-sm">
                     <i class="fas fa-keyboard mr-2"></i> 对方正在输入...
                 </div>
            </template>
        </div>
    </section>

    <!-- 5. 结局页面 -->
    <section x-show="scene === 'ending'" class="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center text-center p-6 transition-colors duration-2000" :class="endingReveal ? 'bg-bgMain' : 'bg-black'">

        <div x-show="!endingReveal" class="text-white opacity-80 animate-pulse">
            ...
        </div>

        <div x-show="endingReveal" class="flex flex-col items-center w-full h-full justify-between py-10 animate-fade-in-up">
            <!-- 顶部文案 -->
            <div class="space-y-4 max-w-md mx-auto z-10">
                 <template x-for="line in endingText">
                     <p class="text-lg md:text-xl font-medium text-gray-800" x-text="line"></p>
                 </template>
                 <div class="pt-6">
                     <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-pink-500 animate-pulse">
                         付QQ，生日快乐！！！
                     </h1>
                 </div>
            </div>

            <!-- 底部大图 -->
            <div class="relative w-full max-w-sm aspect-[3/4] mt-6 shadow-2xl rounded-2xl overflow-hidden transform rotate-2 border-4 border-white">
                <img :src="imgUrl('FQQHappyBirthday.png')" class="w-full h-full object-cover">
            </div>

            <button @click="location.reload()" class="mt-8 px-8 py-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-black transition-all text-sm tracking-widest">
                再做一次梦
            </button>
        </div>
    </section>

    <script>
        // GitHub CDN Base (使用 jsDelivr 加速国内访问)
        const CDN_BASE = 'https://cdn.jsdelivr.net/gh/LOOTOOT/WorkingQQ@main/';

        // 处理URL编码的辅助函数
        function getAssetUrl(filename) {
            return CDN_BASE + encodeURIComponent(filename);
        }

        function gameData() {
            return {
                scene: 'login', // login, start, game, wechat, ending
                loginClicked: false,
                loginSuccess: false,

                // VN Logic variables
                currentNodeId: 'start_sleep',
                dialogue: {},
                shakeEffect: false,
                isGameScene: false, // Computed helper

                // WeChat Logic variables
                chatHistory: [],
                chatOptions: null,
                chatSystemMsg: null,

                // Ending Logic
                endingText: [],
                endingReveal: false,
                fromRoute: '', // 'sleep' or 'fight' or 'reality'

                init() {
                    // Watchers or Initializers can go here
                    this.$watch('scene', (val) => {
                        this.isGameScene = (val === 'game');
                        if (val === 'ending') this.playEnding();
                    });
                },

                imgUrl(filename) {
                    return getAssetUrl(filename);
                },

                preloadImages() {
                    // 简单预加载关键图片
                    const images = ['fqq-avtar.jpg', 'mainpage.jpg', 'sleeping.png'];
                    images.forEach(img => {
                        const i = new Image();
                        i.src = this.imgUrl(img);
                    });
                },

                // 1. 登录逻辑
                handleLogin(e) {
                    if (this.loginClicked) return;
                    this.loginClicked = true;

                    // 创建波纹DOM
                    const container = document.getElementById('ripple-container');
                    const circle = document.createElement('div');
                    circle.classList.add('login-ripple');
                    // 简单居中处理，不需要计算鼠标位置了，因为是全屏动效
                    container.appendChild(circle);

                    setTimeout(() => {
                        this.loginSuccess = true;
                        setTimeout(() => {
                            this.scene = 'start';
                        }, 1500);
                    }, 1000);
                },

                // 2. 开始游戏
                startGame() {
                    // 尝试播放音乐 (需要用户交互)
                    const bgm = document.getElementById('bgm');
                    bgm.volume = 0.3;
                    // 这里暂时不播放，等到生日快乐再放，或者现在放背景音
                    // bgm.play().catch(e => console.log("Audio autoplay blocked"));

                    this.scene = 'game';
                    this.loadScene('start_sleep');
                },

                // 3. VN 引擎核心
                loadScene(nodeId) {
                    this.currentNodeId = nodeId;
                    const node = this.storyNodes[nodeId];

                    if (!node) { console.error('Node not found:', nodeId); return; }

                    // 如果是特殊指令：跳转到微信或结局
                    if (node.type === 'switch_wechat') {
                        this.scene = 'wechat';
                        this.initWeChat();
                        return;
                    }
                    if (node.type === 'ending') {
                        this.fromRoute = node.route;
                        this.scene = 'ending';
                        return;
                    }

                    // 设置当前对话状态
                    this.dialogue = {
                        text: node.text,
                        image: node.image,
                        speaker: node.speaker || '',
                        options: node.options || null,
                        isBig: node.effect === 'big',
                        next: node.next || null
                    };

                    // 处理特效
                    if (node.effect === 'shake') {
                        this.shakeEffect = true;
                        if (navigator.vibrate) navigator.vibrate(200);
                        setTimeout(() => this.shakeEffect = false, 500);
                    }
                },

                nextText() {
                    // 如果有选项，必须点选项
                    if (this.dialogue.options) return;
                    // 如果有下一句，加载下一句
                    if (this.dialogue.next) {
                        this.loadScene(this.dialogue.next);
                    }
                },

                makeChoice(nextNodeId) {
                    this.loadScene(nextNodeId);
                },

                // 4. 微信逻辑
                async initWeChat() {
                    this.chatHistory = [];
                    // 初始对话
                    await this.delay(1000);
                    this.addChatMsg('keys', '付QQ你怎么敢挂老师电话？');
                    await this.delay(800);
                    this.addChatMsg('keys', '太不像话了！');
                    await this.delay(500);

                    this.chatOptions = [
                        { text: 'A. （继续输出）我就这样，怎么着？', next: 'chat_A' },
                        { text: 'B. （无视）已读不回', next: 'chat_B' }
                    ];
                },

                addChatMsg(who, text) {
                    this.chatHistory.push({
                        isMe: who === 'me',
                        text: text
                    });
                    // 滚动到底部
                    this.$nextTick(() => {
                        const container = document.getElementById('chat-container');
                        container.scrollTop = container.scrollHeight;
                    });
                },

                async handleChatOption(opt) {
                    this.chatOptions = null; // 隐藏选项

                    if (opt.next === 'chat_A') {
                        this.addChatMsg('me', '不像话的是你吧？周末早上八点打电话让人做PPT？');
                        await this.delay(1000);
                        this.addChatMsg('me', '你自己怎么不做？就知道使唤学生？');
                        await this.delay(1500);
                        this.addChatMsg('keys', '你这样态度有问题，我要跟你家长谈谈！');
                        await this.delay(1000);
                        this.addChatMsg('me', '谈啊，说我在学校被当免费劳动力');
                        await this.delay(800);
                        this.addChatMsg('me', '你打啊，现在就打');
                        await this.delay(2000);
                        this.chatSystemMsg = '"钥匙老师" 撤回了一条消息';
                        await this.delay(1000);
                        this.addChatMsg('keys', '算了，你冷静一下。PPT我找别人做。');
                        await this.delay(2000);
                        this.fromRoute = 'fight';
                        this.scene = 'ending';
                    } else {
                        await this.delay(1000);
                        this.addChatMsg('keys', '？');
                        await this.delay(1000);
                        this.addChatMsg('keys', '付QQ，看到回复。');
                        await this.delay(2000); // 模拟10分钟
                        this.chatSystemMsg = '10分钟后';
                        await this.delay(1000);
                        this.addChatMsg('keys', '行，你厉害。PPT不用你做了。');
                        await this.delay(2000);
                        this.fromRoute = 'fight';
                        this.scene = 'ending';
                    }
                },

                delay(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                },

                // 5. 结局逻辑
                playEnding() {
                    // 播放音乐
                    const bgm = document.getElementById('bgm');
                    bgm.play().catch(e => console.log('Interact first'));

                    // 准备文案
                    if (this.fromRoute === 'fight') {
                        // 猛人线
                        this.endingText = [
                             "你猛地睁开眼睛。",
                             "阳光从窗帘缝隙洒进来，宿舍里安安静静。",
                             "原来……是一场梦啊。",
                             "但不得不说，骂得真爽。",
                             "虽然梦是假的，但爽是真的。",
                             "今天是12月7日——"
                        ];
                    } else if (this.fromRoute === 'sleep') {
                        // 睡到自然醒
                        this.endingText = [
                            "你舒服地翻了个身，沉沉睡去。",
                            "再次醒来，已经是中午。",
                            "阳光明媚，周末大好。",
                            "没有电话，没有PPT，只有惬意的休息。",
                            "今天是12月7日——"
                        ];
                    } else {
                        // 现实线 (bad ending)
                        this.endingText = [
                            "你盯着熟悉的帘子。",
                            "手机安静地躺在枕边。",
                            "没有电话，没有PPT。",
                            "原来……是一场梦啊。",
                            "虽然在梦里也被CPU了，但那都是假的。",
                            "嘿，今天是你生日，开心一点吧。"
                        ];
                    }

                    // 动画流程
                    setTimeout(() => {
                        this.endingReveal = true;
                        this.fireConfetti();
                    }, 2000);
                },

                fireConfetti() {
                    var duration = 15 * 1000;
                    var animationEnd = Date.now() + duration;
                    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 100 };

                    var interval = setInterval(function() {
                        var timeLeft = animationEnd - Date.now();

                        if (timeLeft <= 0) {
                            return clearInterval(interval);
                        }

                        var particleCount = 50 * (timeLeft / duration);
                        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
                    }, 250);
                },

                // 数据结构：剧情节点
                storyNodes: {
                    'start_sleep': {
                        image: 'sleeping.png',
                        text: '你是付QQ，23英语2班的班长。',
                        next: 'intro_2'
                    },
                    'intro_2': {
                        image: 'sleeping.png',
                        text: 'AAA纯血正宗PPT大王AKA导员免费劳动力',
                        next: 'intro_3'
                    },
                    'intro_3': {
                        image: 'sleeping.png',
                        text: '现在是北京时间12月7日，早上8点20分<br>你正在享受美好的周末',
                        next: 'alarm_shock'
                    },
                    'alarm_shock': {
                        image: 'sleeping.png', // Or shake screen
                        text: '一阵强劲的音乐袭来！',
                        effect: 'big',
                        next: 'call_choice'
                    },
                    'call_choice': {
                        image: 'sleeping.png',
                        text: '是你的QQ电话响了呢，你决定',
                        options: [
                            { text: 'A. 谁啊？接一下吧', next: 'pickup_phone' },
                            { text: 'B. 都衮，没人能阻止我睡觉', next: 'end_sleep' }
                        ]
                    },
                    // 分支：睡觉结局
                    'end_sleep': {
                        type: 'ending',
                        route: 'sleep'
                    },
                    // 分支：接电话
                    'pickup_phone': {
                        image: '付QQ接电话无语.png',
                        text: '「喂，老师。」<br>手机传来你导员的声音',
                        next: 'cpu_task'
                    },
                    'cpu_task': {
                        image: '付QQ接电话无语.png',
                        text: '「付QQ你现在做一个优秀班集体的PPT，下午4点前给我。」',
                        next: 'reaction_choice'
                    },
                    'reaction_choice': {
                        image: '付QQ接电话无语.png',
                        text: '………什么玩意儿？做PPT？你...',
                        options: [
                            { text: 'A. 怒了，拒绝', next: 'angry_mode' },
                            { text: 'B. 已老实，一会儿就去做', next: 'submissive_mode' }
                        ]
                    },
                    // 分支：老实人
                    'submissive_mode': {
                        image: '付QQ接电话无语.png',
                        text: '你叹了口气：「好的老师，我尽快做」',
                        next: 'working_hard'
                    },
                    'working_hard': {
                        image: '晕头转向电脑局.png',
                        text: '挂了电话，你打开电脑开始收集材料。<br>中午煮了火鸡面，你边吃边做。',
                        next: 'work_feedback'
                    },
                    'work_feedback': {
                        image: '晕头转向电脑局.png',
                        text: '下午3点发到老师邮箱。<br>老师回复：‘下次要更主动些’',
                        next: 'end_reality_pre'
                    },
                    'end_reality_pre': {
                        image: '晕头转向电脑局.png', // Should fade to black ideally
                        text: '你苦笑一下，关掉电脑。躺回床上休息，盯着天花板发呆...',
                        next: 'end_reality'
                    },
                    'end_reality': {
                        type: 'ending',
                        route: 'reality'
                    },
                    // 分支：怒了
                    'angry_mode': {
                        image: '我骟QQ彻底怒了.png',
                        text: '大早上做什么PPT？你彻底怒了。<br>往日种种在眼前浮现，你忍无可忍，速速动手',
                        next: 'bubble_preclick'
                    },
                    'bubble_preclick': {
                        image: '我骟QQ彻底怒了.png',
                        text: '「你不会做PPT吗？自己搞啊」', // 这里简化点击逻辑，直接当文本展示
                        effect: 'big',
                        next: 'teacher_shocked'
                    },
                    'teacher_shocked': {
                        image: '我骟QQ彻底怒了.png',
                        text: '手机传来导员低沉的声音：「付QQ你怎么和老师说话的？」',
                        options: [
                            { text: 'A. 我现在就这个态度，不爱听别听', next: 'fight_attitude' },
                            { text: 'B. 对不起老师我刚刚没睡醒', next: 'submissive_mode' } // 回到老实人线
                        ]
                    },
                    'fight_attitude': {
                        image: '我骟QQ彻底怒了.png',
                        text: '电话那头安静如鸡，随后是带着怒意的一声喊：「付QQ！」<br>你毫不示弱：「吼那么大声干嘛？现在是周末！我还在睡觉！」',
                        next: 'shenwei'
                    },
                    'shenwei': {
                        image: '付QQ神威大发.png',
                        text: '导员：「你是班长，要有奉献精神！」',
                        options: [
                            { text: 'A. 奉献精神？那你给我发工资了吗？', next: 'salary_talk' },
                            { text: 'B. 这班长谁爱当谁当，我不干了！', next: 'quit_talk' }
                        ]
                    },
                    'salary_talk': {
                        image: '付QQ脚踩金钥.png',
                        text: '「你给我工资了吗要求这么多？我白干这么久还没找你算账呢！」<br>导员：「你怎么这么计较」',
                        next: 'salary_calc'
                    },
                    'salary_calc': {
                        image: '付QQ脚踩金钥.png',
                        text: '你乘胜追击：「计较？那我们现在就算算，我干了多少活，你该给我多少钱？」<br>导员：「好了，你先休息」',
                        next: 'hang_up_win'
                    },
                    'quit_talk': {
                        image: '付QQ脚踩金钥.png',
                        text: '「这班长谁爱当谁当！你现在就找别人，我立刻退出所有群！」<br>导员：「付QQ有话好好说」',
                        next: 'hang_up_win_2'
                    },
                    'hang_up_win': {
                        image: '付QQ战斗胜利结算画面.png',
                        text: '「啪！」你直接挂了电话。<br>怼得你神清气爽，也不多啰嗦。',
                        type: 'switch_wechat'
                    },
                    'hang_up_win_2': { // Quit talk branch
                        image: '付QQ战斗胜利结算画面.png',
                        text: '「没什么好说的，我受够了。再见。」<br>「啪！」你干脆利落地挂了电话。<br>怼得你神清气爽。',
                        type: 'switch_wechat'
                    }
                }
            }
        }

        // Helper for confetti
        function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }
    </script>
</body>
</html>