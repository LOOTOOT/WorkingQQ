<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>付QQ的最终幻想</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=ZCOOL+KuaiLe&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --bg-primary: #FFFBF8;
            --bg-secondary: #FFCCB6;
            --accent: #D8F878;
            --accent-dark: #b8d858;
            --text-dark: #2d2d2d;
            --text-light: #666;
            --wechat-green: #95EC69;
            --wechat-white: #FFFFFF;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-medium: 0 8px 40px rgba(0,0,0,0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Noto Sans SC', sans-serif;
            background: var(--bg-primary);
            color: var(--text-dark);
        }
        
        /* ==================== 通用容器 ==================== */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s ease;
            overflow: hidden;
        }
        
        .screen.active {
            display: flex;
            opacity: 1;
        }
        
        .screen.fade-out {
            opacity: 0;
        }
        
        /* ==================== 渐变背景 ==================== */
        .gradient-bg {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--accent) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ==================== 登录页面 ==================== */
        #login-screen {
            background: linear-gradient(180deg, #0a0a15 0%, #1a1a2e 40%, #16213e 70%, #0f3460 100%);
            position: relative;
        }
        
        #login-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(216, 248, 120, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(255, 204, 182, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .login-text {
            font-size: 1.8rem;
            font-weight: 300;
            color: white;
            letter-spacing: 0.8em;
            opacity: 0;
            font-family: 'Noto Sans SC', sans-serif;
            text-shadow: 0 0 30px rgba(255,255,255,0.3);
        }
        
        .login-text.typing {
            animation: typeIn 2s ease forwards, fadeOutText 1s ease 3s forwards;
        }
        
        @keyframes typeIn {
            0% { opacity: 0; letter-spacing: 1em; }
            100% { opacity: 1; letter-spacing: 0.5em; }
        }
        
        @keyframes fadeOutText {
            to { opacity: 0; }
        }
        
        .avatar-container {
            position: relative;
            width: 130px;
            height: 130px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }
        
        .avatar-container.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        .avatar-container:active {
            transform: scale(0.95);
        }
        
        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255,255,255,0.2);
            transition: all 0.4s ease;
            box-shadow: 
                0 0 0 4px rgba(216, 248, 120, 0.1),
                0 0 30px rgba(0,0,0,0.3),
                0 0 60px rgba(216, 248, 120, 0.1);
        }
        
        .avatar-container:hover .avatar {
            border-color: rgba(216, 248, 120, 0.5);
            box-shadow: 
                0 0 0 4px rgba(216, 248, 120, 0.2),
                0 0 40px rgba(216, 248, 120, 0.3),
                0 0 80px rgba(216, 248, 120, 0.1);
        }
        
        .avatar-glow {
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, transparent, var(--accent), transparent 30%, var(--bg-secondary), transparent 60%, var(--accent), transparent);
            opacity: 0;
            animation: none;
            filter: blur(2px);
        }
        
        .avatar-container.clicked .avatar-glow {
            animation: glowSpin 1.2s linear forwards;
        }
        
        .avatar-container.clicked .avatar {
            animation: avatarPulse 0.6s ease;
        }
        
        @keyframes avatarPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes glowSpin {
            0% { opacity: 0; transform: rotate(0deg); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: rotate(360deg); }
        }
        
        /* 波纹效果 */
        .ripple {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
            pointer-events: none;
            animation: rippleExpand 1.5s ease-out forwards;
        }
        
        @keyframes rippleExpand {
            0% { 
                width: 0; 
                height: 0; 
                opacity: 0.8; 
            }
            100% { 
                width: 300vmax; 
                height: 300vmax; 
                opacity: 0; 
            }
        }
        
        .login-success {
            position: absolute;
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--accent);
            opacity: 0;
            letter-spacing: 0.3em;
        }
        
        .login-success.show {
            animation: successPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        
        @keyframes successPop {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* ==================== 主页面 ==================== */
        #main-screen {
            background: #000;
        }
        
        .main-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        
        .start-hint {
            position: absolute;
            bottom: 15%;
            font-size: 1rem;
            color: rgba(255,255,255,0.9);
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            animation: breathe 2.5s ease-in-out infinite;
            font-family: 'Noto Sans SC', sans-serif;
            letter-spacing: 0.2em;
        }
        
        @keyframes breathe {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
        }
        
        /* ==================== 故事页面 ==================== */
        #story-screen {
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            padding: 0;
        }
        
        .story-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }
        
        .story-image-wrapper {
            width: 100%;
            max-width: 380px;
            max-height: 45vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            border-radius: 24px;
        }
        
        .story-image-wrapper::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--accent), var(--bg-secondary), var(--accent));
            border-radius: 26px;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: -1;
        }
        
        .story-image-wrapper:has(.story-image.visible)::before {
            opacity: 0.6;
        }
        
        .story-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 22px;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.15),
                0 0 0 1px rgba(255,255,255,0.1);
            opacity: 0;
            transform: scale(0.92) translateY(10px);
            transition: all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .story-image.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        
        .story-image.wipe-out {
            animation: wipeOut 0.8s ease forwards;
        }
        
        @keyframes wipeOut {
            0% { clip-path: inset(0 0 0 0); opacity: 1; }
            100% { clip-path: inset(0 100% 0 0); opacity: 0; }
        }
        
        .story-text-area {
            width: 100%;
            max-width: 400px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        .story-text {
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: center;
            color: var(--text-dark);
            opacity: 0;
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .story-text.expand-in {
            animation: expandFromCenter 0.8s ease forwards;
        }
        
        @keyframes expandFromCenter {
            0% { 
                opacity: 0; 
                clip-path: inset(0 50% 0 50%);
            }
            100% { 
                opacity: 1; 
                clip-path: inset(0 0 0 0);
            }
        }
        
        .story-text.particle-out {
            animation: particleDissolve 1s ease forwards;
        }
        
        @keyframes particleDissolve {
            0% { 
                opacity: 1; 
                filter: blur(0); 
                transform: scale(1);
            }
            100% { 
                opacity: 0; 
                filter: blur(10px); 
                transform: scale(1.1);
            }
        }
        
        .story-text.bold-shake {
            font-size: 1.4rem;
            font-weight: 700;
            animation: expandFromCenter 0.8s ease forwards, textShake 0.5s ease 0.8s;
        }
        
        @keyframes textShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
        }
        
        /* 选项按钮 */
        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 350px;
            margin-top: 20px;
            opacity: 0;
        }
        
        .choices-container.visible {
            animation: fadeSlideUp 0.5s ease forwards;
        }
        
        @keyframes fadeSlideUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .choice-btn {
            padding: 16px 24px;
            font-size: 1rem;
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,251,248,0.9));
            border: 2px solid rgba(216, 248, 120, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .choice-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(216, 248, 120, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .choice-btn:hover::before, .choice-btn:active::before {
            left: 100%;
        }
        
        .choice-btn:hover, .choice-btn:active {
            transform: scale(1.03) translateY(-2px);
            border-color: var(--accent);
            box-shadow: 0 8px 25px rgba(216, 248, 120, 0.25), 0 4px 15px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, rgba(255,255,255,1), rgba(216, 248, 120, 0.15));
        }
        
        .choice-btn span {
            position: relative;
            z-index: 1;
        }
        
        /* 气泡样式 */
        .bubble {
            background: white;
            padding: 16px 24px;
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
            position: relative;
            max-width: 300px;
            margin: 20px auto;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .bubble:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-medium);
        }
        
        .bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-top-color: white;
        }
        
        /* 页面震动 */
        .shake {
            animation: pageShake 0.6s ease;
        }
        
        @keyframes pageShake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-8px, -4px); }
            20% { transform: translate(8px, 4px); }
            30% { transform: translate(-6px, 2px); }
            40% { transform: translate(6px, -2px); }
            50% { transform: translate(-4px, 4px); }
            60% { transform: translate(4px, -4px); }
            70% { transform: translate(-2px, 2px); }
            80% { transform: translate(2px, -2px); }
            90% { transform: translate(-1px, 1px); }
        }
        
        /* 点击提示 */
        .tap-hint {
            position: absolute;
            bottom: 20px;
            font-size: 0.85rem;
            color: var(--text-light);
            opacity: 0;
            animation: fadeInOut 2s ease infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.7; }
        }
        
        /* ==================== 微信聊天页面 ==================== */
        #wechat-screen {
            background: #EDEDED;
        }
        
        .wechat-container {
            width: 100%;
            height: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            background: #EDEDED;
        }
        
        .wechat-header {
            background: #EDEDED;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
            position: relative;
        }
        
        .wechat-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.05), transparent);
        }
        
        .wechat-back {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-right: 12px;
            opacity: 0.6;
        }
        
        .wechat-title {
            font-size: 1.05rem;
            font-weight: 500;
            flex: 1;
            text-align: center;
            margin-right: 24px;
        }
        
        .wechat-messages {
            flex: 1;
            padding: 16px 12px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #EDEDED;
        }
        
        .message-row {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            opacity: 0;
            transform: translateY(8px);
        }
        
        .message-row.visible {
            animation: messageIn 0.35s ease forwards;
        }
        
        @keyframes messageIn {
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-row.right {
            flex-direction: row-reverse;
        }
        
        .msg-avatar {
            width: 42px;
            height: 42px;
            border-radius: 5px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .msg-bubble {
            max-width: 65%;
            padding: 10px 14px;
            border-radius: 4px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            word-break: break-word;
        }
        
        .message-row.left .msg-bubble {
            background: var(--wechat-white);
            border-radius: 0 4px 4px 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .message-row.left .msg-bubble::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            border: 6px solid transparent;
            border-right-color: var(--wechat-white);
            border-top-color: var(--wechat-white);
        }
        
        .message-row.right .msg-bubble {
            background: var(--wechat-green);
            border-radius: 4px 0 4px 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .message-row.right .msg-bubble::before {
            content: '';
            position: absolute;
            right: -6px;
            top: 0;
            border: 6px solid transparent;
            border-left-color: var(--wechat-green);
            border-top-color: var(--wechat-green);
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 10px 14px;
            background: var(--wechat-white);
            border-radius: 4px;
            width: fit-content;
        }
        
        .typing-indicator span {
            width: 6px;
            height: 6px;
            background: #b0b0b0;
            border-radius: 50%;
            animation: typingBounce 1.4s ease-in-out infinite;
        }
        
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-4px); opacity: 1; }
        }
        
        .system-message {
            text-align: center;
            font-size: 0.8rem;
            color: #b0b0b0;
            padding: 8px 16px;
            background: rgba(0,0,0,0.03);
            border-radius: 4px;
            margin: 8px auto;
            max-width: 200px;
        }
        
        .wechat-choices {
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
            background: #f7f7f7;
            border-top: 0.5px solid rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .wechat-choice-btn {
            padding: 14px 18px;
            font-size: 0.9rem;
            font-family: 'Noto Sans SC', sans-serif;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.25s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            text-align: left;
            color: var(--text-dark);
        }
        
        .wechat-choice-btn:active {
            transform: scale(0.98);
            background: #f5f5f5;
            box-shadow: 0 1px 2px rgba(0,0,0,0.04);
        }
        
        /* ==================== 结局页面 ==================== */
        #ending-screen {
            background: #000;
            transition: background 2s ease;
        }
        
        .ending-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            position: relative;
            z-index: 1;
        }
        
        .ending-text {
            font-size: 1.15rem;
            line-height: 2.2;
            text-align: center;
            color: rgba(255,255,255,0.95);
            opacity: 0;
            max-width: 340px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .ending-text.fade-in {
            animation: endingFadeIn 1.8s ease forwards;
        }
        
        @keyframes endingFadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .ending-image {
            max-width: 85%;
            max-height: 45vh;
            object-fit: contain;
            border-radius: 20px;
            margin-top: 20px;
            opacity: 0;
            transform: scale(0.9);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .ending-image.pop-in {
            animation: endingImagePop 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        
        @keyframes endingImagePop {
            0% { opacity: 0; transform: scale(0.85) rotate(-2deg); }
            60% { transform: scale(1.02) rotate(1deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        
        /* 礼花效果 */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1000;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall linear forwards;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100%) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* 生日文字 */
        .birthday-title {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(
                135deg, 
                #ff6b6b 0%, 
                #feca57 20%, 
                #D8F878 40%, 
                #48dbfb 60%, 
                #ff9ff3 80%, 
                #ff6b6b 100%
            );
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-top: 24px;
            opacity: 0;
            text-align: center;
            font-family: 'ZCOOL KuaiLe', 'Noto Sans SC', sans-serif;
            text-shadow: none;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            animation: none;
        }
        
        .birthday-title.celebrate {
            animation: 
                birthdayCelebrate 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
                rainbowShift 3s linear infinite 1s;
        }
        
        @keyframes birthdayCelebrate {
            0% { opacity: 0; transform: scale(0.5) rotate(-10deg); }
            50% { transform: scale(1.15) rotate(5deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        
        @keyframes rainbowShift {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        /* 加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--bg-secondary);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 音频控制 */
        .audio-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-soft);
            z-index: 100;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .audio-toggle.visible {
            opacity: 1;
        }
        
        .audio-toggle:active {
            transform: scale(0.95);
        }
        
        .audio-toggle i {
            font-size: 1.2rem;
            color: var(--text-dark);
        }
        
        /* 响应式调整 */
        @media (min-width: 768px) {
            .story-image-wrapper {
                max-width: 500px;
                max-height: 55vh;
            }
            
            .story-text {
                font-size: 1.2rem;
            }
            
            .choice-btn {
                font-size: 1.1rem;
            }
        }
        
        /* 安全区域适配 - iOS刘海屏等 */
        @supports (padding: env(safe-area-inset-bottom)) {
            .story-container {
                padding-bottom: calc(20px + env(safe-area-inset-bottom));
            }
            
            .ending-container {
                padding-bottom: calc(24px + env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- 音频控制按钮 -->
    <button class="audio-toggle" id="audioToggle" aria-label="音乐开关">
        <i class="fas fa-volume-up"></i>
    </button>
    
    <!-- 背景音乐 -->
    <audio id="bgm" loop preload="auto">
        <source src="https://cdn.jsdelivr.net/gh/LOOTOOT/WorkingQQ@main/HappyBirthdaySong.mp3" type="audio/mpeg">
    </audio>
    
    <!-- 音效 -->
    <audio id="sfx-click" preload="auto">
        <source src="https://cdn.jsdelivr.net/gh/nickyonge/javascript-sfx/sfx/click.mp3" type="audio/mpeg">
    </audio>
    <audio id="sfx-message" preload="auto">
        <source src="https://cdn.jsdelivr.net/gh/nickyonge/javascript-sfx/sfx/pop.mp3" type="audio/mpeg">
    </audio>
    
    <!-- ==================== 登录页面 ==================== -->
    <div class="screen active" id="login-screen">
        <p class="login-text" id="loginText">请 登 录</p>
        <div class="avatar-container" id="avatarContainer">
            <div class="avatar-glow"></div>
            <img class="avatar" src="https://cdn.jsdelivr.net/gh/LOOTOOT/WorkingQQ@main/fqq-avtar.jpg" alt="头像" loading="eager">
        </div>
        <p class="login-success" id="loginSuccess">登入成功</p>
    </div>
    
    <!-- ==================== 主页面 ==================== -->
    <div class="screen" id="main-screen">
        <img class="main-bg" src="https://cdn.jsdelivr.net/gh/LOOTOOT/WorkingQQ@main/mainpage.jpg" alt="主页背景" loading="eager">
        <p class="start-hint">点击任意地方开始做梦</p>
    </div>
    
    <!-- ==================== 故事页面 ==================== -->
    <div class="screen" id="story-screen">
        <div class="story-container" id="storyContainer">
            <div class="story-image-wrapper">
                <img class="story-image" id="storyImage" src="" alt="故事配图">
            </div>
            <div class="story-text-area">
                <p class="story-text" id="storyText"></p>
            </div>
            <div class="choices-container" id="choicesContainer"></div>
            <p class="tap-hint" id="tapHint">点击继续</p>
        </div>
    </div>
    
    <!-- ==================== 微信页面 ==================== -->
    <div class="screen" id="wechat-screen">
        <div class="wechat-container">
            <div class="wechat-header">
                <i class="fas fa-chevron-left wechat-back"></i>
                <span class="wechat-title">导员CPU版</span>
            </div>
            <div class="wechat-messages" id="wechatMessages"></div>
            <div class="wechat-choices" id="wechatChoices"></div>
        </div>
    </div>
    
    <!-- ==================== 结局页面 ==================== -->
    <div class="screen" id="ending-screen">
        <div class="ending-container">
            <div id="endingTextContainer"></div>
            <img class="ending-image" id="endingImage" src="" alt="结局图片">
            <h1 class="birthday-title" id="birthdayTitle"></h1>
        </div>
        <div class="confetti-container" id="confettiContainer"></div>
    </div>

    <script>
        // ==================== 图片资源 CDN ====================
        const CDN_BASE = 'https://cdn.jsdelivr.net/gh/LOOTOOT/WorkingQQ@main/';
        const IMAGES = {
            avatar: CDN_BASE + 'fqq-avtar.jpg',
            avatarLeft: CDN_BASE + 'img-left.jpg',
            mainpage: CDN_BASE + 'mainpage.jpg',
            sleeping: CDN_BASE + 'sleeping.png',
            phoneCall: CDN_BASE + '付QQ接电话无语.png',
            angry: CDN_BASE + '我骟QQ彻底怒了.png',
            powerful: CDN_BASE + '付QQ神威大发.png',
            stepping: CDN_BASE + '付QQ脚踩金钥.png',
            victory: CDN_BASE + '付QQ战斗胜利结算画面.png',
            computer: CDN_BASE + '晕头转向电脑局.png',
            wakeup: CDN_BASE + '躺在床上睁眼的付QQ.png',
            birthday: CDN_BASE + 'FQQHappyBirthday.png'
        };
        
        // ==================== 游戏状态 ====================
        const GameState = {
            currentScreen: 'login',
            storyStep: 0,
            branch: 'main',
            endingType: null, // 'hero-victory', 'hero-quiet', 'hero-sleep', 'reality'
            audioEnabled: true
        };
        
        // ==================== DOM 元素 ====================
        const $ = id => document.getElementById(id);
        const screens = {
            login: $('login-screen'),
            main: $('main-screen'),
            story: $('story-screen'),
            wechat: $('wechat-screen'),
            ending: $('ending-screen')
        };
        
        const audioToggle = $('audioToggle');
        const bgm = $('bgm');
        const sfxClick = $('sfx-click');
        const sfxMessage = $('sfx-message');
        
        // ==================== 工具函数 ====================
        function playSound(audio) {
            if (GameState.audioEnabled && audio) {
                audio.currentTime = 0;
                audio.play().catch(() => {});
            }
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function switchScreen(from, to) {
            return new Promise(resolve => {
                screens[from].classList.add('fade-out');
                setTimeout(() => {
                    screens[from].classList.remove('active', 'fade-out');
                    screens[to].classList.add('active');
                    GameState.currentScreen = to;
                    resolve();
                }, 500);
            });
        }
        
        function createRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.style.marginLeft = '-150vmax';
            ripple.style.marginTop = '-150vmax';
            document.body.appendChild(ripple);
            setTimeout(() => ripple.remove(), 1500);
        }
        
        function createConfetti() {
            const container = $('confettiContainer');
            const colors = ['#D8F878', '#FFCCB6', '#ff9a9e', '#fad0c4', '#a18cd1', '#fbc2eb', '#ffecd2', '#fcb69f', '#ff6b6b', '#4ecdc4'];
            
            for (let i = 0; i < 80; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = (Math.random() * 12 + 6) + 'px';
                    confetti.style.height = (Math.random() * 12 + 6) + 'px';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '3px';
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    container.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 5500);
                }, i * 30);
            }
        }
        
        // 震动效果（支持手机）
        function vibrate(pattern) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }
        
        // ==================== 预加载图片 ====================
        async function preloadImages() {
            const promises = Object.values(IMAGES).map(src => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = resolve;
                    img.onerror = resolve; // 即使失败也继续
                    img.src = src;
                });
            });
            await Promise.all(promises);
        }
        
        // ==================== 登录流程 ====================
        async function initLogin() {
            const loginText = $('loginText');
            const avatarContainer = $('avatarContainer');
            const loginSuccess = $('loginSuccess');
            
            // 显示"请登录"文字
            await delay(500);
            loginText.classList.add('typing');
            
            // 等待文字消失后显示头像
            await delay(4000);
            loginText.style.display = 'none';
            avatarContainer.classList.add('visible');
            
            // 头像点击事件
            avatarContainer.addEventListener('click', async function handleAvatarClick(e) {
                avatarContainer.removeEventListener('click', handleAvatarClick);
                playSound(sfxClick);
                
                // 创建波纹效果
                const rect = avatarContainer.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                createRipple(x, y);
                
                // 头像发光
                avatarContainer.classList.add('clicked');
                
                await delay(800);
                avatarContainer.style.opacity = '0';
                avatarContainer.style.transform = 'scale(0.5)';
                
                await delay(400);
                loginSuccess.classList.add('show');
                
                await delay(1500);
                await switchScreen('login', 'main');
                initMain();
            });
        }
        
        // ==================== 主页流程 ====================
        function initMain() {
            const mainScreen = screens.main;
            
            mainScreen.addEventListener('click', async function handleMainClick() {
                mainScreen.removeEventListener('click', handleMainClick);
                playSound(sfxClick);
                await switchScreen('main', 'story');
                initStory();
            });
        }
        
        // ==================== 故事系统 ====================
        const storyData = {
            // 开场
            intro: [
                { text: '你是付QQ，23英语2班的班长。', image: IMAGES.sleeping },
                { text: 'AAA纯血正宗PPT大王AKA导员免费劳动力', image: IMAGES.sleeping },
                { text: '现在是北京时间12月7日，早上8点20分\n你正在享受美好的周末', image: IMAGES.sleeping, particleOut: true },
                { text: '一阵强劲的音乐袭来！', bold: true, shake: true, wipeImage: true },
                { text: '是你的QQ电话响了呢，你决定', small: true },
                {
                    choices: [
                        { text: 'A. 谁啊？接一下吧', branch: 'phone-answer' },
                        { text: 'B. 都衮，没人能阻止我睡觉', branch: 'sleep' }
                    ]
                }
            ],
            
            // 接电话分支
            'phone-answer': [
                { text: '「喂，老师。」', image: IMAGES.phoneCall },
                { text: '手机传来你导员的声音' },
                { text: '「付QQ你现在做一个优秀班集体的PPT，下午4点前给我。」' },
                { text: '………什么玩意儿？做PPT？你' },
                {
                    choices: [
                        { text: 'A. 怒了，拒绝', branch: 'angry' },
                        { text: 'B. 已老实，一会儿就去做', branch: 'obey' }
                    ]
                }
            ],
            
            // 睡觉分支 -> 结局
            'sleep': [
                { ending: 'hero-sleep' }
            ],
            
            // 愤怒分支
            'angry': [
                { text: '大早上做什么PPT？你彻底怒了', image: IMAGES.angry },
                { text: '往日种种在眼前浮现，你忍无可忍，速速动手' },
                { bubble: '「你不会做PPT吗？自己搞啊」' },
                { text: '手机传来导员低沉的声音：「付QQ你怎么和老师说话的？」' },
                {
                    choices: [
                        { text: 'A. 我现在就这个态度，不爱听别听', branch: 'confront' },
                        { text: 'B. 对不起老师我刚刚没睡醒', branch: 'obey' }
                    ]
                }
            ],
            
            // 对抗分支
            'confront': [
                { text: '电话那头安静如鸡，随后是带着怒意的一声喊：「付QQ！」' },
                { text: '你毫不示弱：「吼那么大声干嘛？现在是周末！我还在睡觉！」', image: IMAGES.powerful },
                { text: '导员：「你是班长，要有奉献精神！」' },
                {
                    choices: [
                        { text: 'A. 奉献精神？那你给我发工资了吗？', branch: 'salary' },
                        { text: 'B. 这班长谁爱当谁当，我不干了！', branch: 'quit' }
                    ]
                }
            ],
            
            // 要工资分支
            'salary': [
                { text: '「你给我工资了吗要求这么多？我白干这么久还没找你算账呢！」' },
                { text: '导员：「你怎么这么计较」', image: IMAGES.stepping },
                { text: '你乘胜追击：「计较？那我们现在就算算，我干了多少活，你该给我多少钱？」' },
                { text: '导员：「好了，你先休息」' },
                { text: '「啪！」你直接挂了电话。' },
                { text: '怼得你神清气爽，也不多啰嗦。', image: IMAGES.victory },
                { goto: 'wechat' }
            ],
            
            // 不干了分支
            'quit': [
                { text: '「这班长谁爱当谁当！你现在就找别人，我立刻退出所有群！」' },
                { text: '导员：「付QQ有话好好说」', image: IMAGES.stepping },
                { text: '「没什么好说的，我受够了。再见。」' },
                { text: '「啪！」你干脆利落地挂了电话。' },
                { text: '怼得你神清气爽，也不多啰嗦。', image: IMAGES.victory },
                { goto: 'wechat' }
            ],
            
            // 老实分支
            'obey': [
                { text: '你叹了口气：「好的老师，我尽快做」' },
                { text: '挂了电话，你打开电脑开始收集材料', image: IMAGES.computer },
                { text: '中午煮了火鸡面，你边吃边做' },
                { text: '下午3点发到老师邮箱' },
                { text: '老师回复：\'下次要更主动些\'' },
                { text: '你苦笑一下，关掉电脑', clearImage: true },
                { text: '躺回床上休息' },
                { text: '盯着天花板发呆...' },
                { ending: 'reality' }
            ]
        };
        
        let currentStoryBranch = 'intro';
        let currentStoryIndex = 0;
        let storyClickable = false;
        
        async function initStory() {
            currentStoryBranch = 'intro';
            currentStoryIndex = 0;
            await showStoryStep();
        }
        
        async function showStoryStep() {
            const data = storyData[currentStoryBranch];
            if (!data || currentStoryIndex >= data.length) return;
            
            const step = data[currentStoryIndex];
            const storyImage = $('storyImage');
            const storyText = $('storyText');
            const choicesContainer = $('choicesContainer');
            const tapHint = $('tapHint');
            const storyContainer = $('storyContainer');
            
            // 清理之前的状态
            choicesContainer.innerHTML = '';
            choicesContainer.classList.remove('visible');
            storyClickable = false;
            tapHint.style.display = 'none';
            
            // 处理结局跳转
            if (step.ending) {
                GameState.endingType = step.ending;
                await switchScreen('story', 'ending');
                initEnding();
                return;
            }
            
            // 处理微信跳转
            if (step.goto === 'wechat') {
                await switchScreen('story', 'wechat');
                initWechat();
                return;
            }
            
            // 处理图片
            if (step.image) {
                storyImage.src = step.image;
                storyImage.classList.remove('visible', 'wipe-out');
                await delay(100);
                storyImage.classList.add('visible');
            }
            
            if (step.wipeImage) {
                storyImage.classList.add('wipe-out');
                await delay(800);
            }
            
            if (step.clearImage) {
                storyImage.classList.remove('visible');
            }
            
            // 处理页面震动
            if (step.shake) {
                storyContainer.classList.add('shake');
                vibrate([100, 50, 100, 50, 100]); // 手机震动
                setTimeout(() => storyContainer.classList.remove('shake'), 600);
            }
            
            // 处理气泡
            if (step.bubble) {
                storyText.innerHTML = '';
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = step.bubble;
                bubble.style.opacity = '0';
                document.querySelector('.story-text-area').appendChild(bubble);
                
                await delay(100);
                bubble.style.opacity = '1';
                bubble.style.transition = 'opacity 0.5s ease';
                
                bubble.addEventListener('click', async () => {
                    playSound(sfxClick);
                    bubble.remove();
                    currentStoryIndex++;
                    await showStoryStep();
                });
                return;
            }
            
            // 处理文字
            if (step.text) {
                storyText.textContent = step.text;
                storyText.className = 'story-text';
                
                if (step.bold) {
                    storyText.classList.add('bold-shake');
                } else {
                    storyText.classList.add('expand-in');
                }
                
                if (step.small) {
                    storyText.style.fontSize = '1rem';
                } else {
                    storyText.style.fontSize = '';
                }
                
                // 粒子消散效果
                if (step.particleOut) {
                    await delay(2500);
                    storyText.classList.remove('expand-in');
                    storyText.classList.add('particle-out');
                    await delay(1000);
                    currentStoryIndex++;
                    await showStoryStep();
                    return;
                }
            }
            
            // 处理选项
            if (step.choices) {
                await delay(500);
                step.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.innerHTML = `<span>${choice.text}</span>`;
                    btn.addEventListener('click', async () => {
                        playSound(sfxClick);
                        currentStoryBranch = choice.branch;
                        currentStoryIndex = 0;
                        
                        storyText.classList.add('particle-out');
                        choicesContainer.style.opacity = '0';
                        await delay(500);
                        
                        await showStoryStep();
                    });
                    choicesContainer.appendChild(btn);
                });
                choicesContainer.classList.add('visible');
                return;
            }
            
            // 普通文字点击继续
            await delay(800);
            tapHint.style.display = 'block';
            storyClickable = true;
        }
        
        // 故事点击事件
        $('storyContainer').addEventListener('click', async (e) => {
            if (!storyClickable) return;
            if (e.target.closest('.choice-btn') || e.target.closest('.bubble')) return;
            
            playSound(sfxClick);
            storyClickable = false;
            
            const storyText = $('storyText');
            storyText.classList.remove('expand-in', 'bold-shake');
            storyText.classList.add('particle-out');
            
            await delay(500);
            currentStoryIndex++;
            await showStoryStep();
        });
        
        // ==================== 微信系统 ====================
        const wechatFlow = [
            { from: 'left', text: '付QQ你怎么敢挂老师电话？' },
            { from: 'left', text: '太不像话了！' },
            {
                choices: [
                    { text: 'A. （继续输出）我就这样，怎么着？', branch: 'wechat-fight' },
                    { text: 'B. （无视）已读不回', branch: 'wechat-ignore' }
                ]
            }
        ];
        
        const wechatBranches = {
            'wechat-fight': [
                { from: 'right', text: '不像话的是你吧？周末早上八点打电话让人做PPT？' },
                { from: 'right', text: '你自己怎么不做？就知道使唤学生？' },
                { from: 'left', text: '你这样态度有问题，我要跟你家长谈谈！' },
                { from: 'right', text: '谈啊，说我在学校被当免费劳动力' },
                { from: 'right', text: '你打啊，现在就打' },
                { system: '…………', delay: 3000 },
                { system: '对方已撤回一条消息' },
                { from: 'left', text: '算了，你冷静一下。PPT我找别人做。' },
                { ending: 'hero-victory' }
            ],
            'wechat-ignore': [
                { from: 'left', text: '？' },
                { from: 'left', text: '付QQ，看到回复。' },
                { system: '十分钟后' },
                { from: 'left', text: '行，你厉害。PPT不用你做了。' },
                { ending: 'hero-quiet' }
            ]
        };
        
        let wechatIndex = 0;
        let currentWechatBranch = null;
        
        async function initWechat() {
            const messagesContainer = $('wechatMessages');
            const choicesContainer = $('wechatChoices');
            messagesContainer.innerHTML = '';
            choicesContainer.innerHTML = '';
            wechatIndex = 0;
            currentWechatBranch = null;
            
            await showWechatStep();
        }
        
        async function showWechatStep() {
            const flow = currentWechatBranch ? wechatBranches[currentWechatBranch] : wechatFlow;
            if (wechatIndex >= flow.length) return;
            
            const step = flow[wechatIndex];
            const messagesContainer = $('wechatMessages');
            const choicesContainer = $('wechatChoices');
            
            // 处理结局
            if (step.ending) {
                await delay(1000);
                GameState.endingType = step.ending;
                await switchScreen('wechat', 'ending');
                initEnding();
                return;
            }
            
            // 处理选项
            if (step.choices) {
                choicesContainer.innerHTML = '';
                step.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'wechat-choice-btn';
                    btn.textContent = choice.text;
                    btn.addEventListener('click', async () => {
                        playSound(sfxClick);
                        choicesContainer.innerHTML = '';
                        currentWechatBranch = choice.branch;
                        wechatIndex = 0;
                        await showWechatStep();
                    });
                    choicesContainer.appendChild(btn);
                });
                return;
            }
            
            // 处理系统消息
            if (step.system) {
                if (step.delay) {
                    await delay(step.delay);
                }
                const sysMsg = document.createElement('div');
                sysMsg.className = 'system-message';
                sysMsg.textContent = step.system;
                messagesContainer.appendChild(sysMsg);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                await delay(800);
                wechatIndex++;
                await showWechatStep();
                return;
            }
            
            // 处理消息
            if (step.from) {
                playSound(sfxMessage);
                
                const row = document.createElement('div');
                row.className = `message-row ${step.from}`;
                
                const avatar = document.createElement('img');
                avatar.className = 'msg-avatar';
                avatar.src = step.from === 'left' ? IMAGES.avatarLeft : IMAGES.avatar;
                
                const bubble = document.createElement('div');
                bubble.className = 'msg-bubble';
                bubble.textContent = step.text;
                
                row.appendChild(avatar);
                row.appendChild(bubble);
                messagesContainer.appendChild(row);
                
                await delay(100);
                row.classList.add('visible');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                await delay(800);
                wechatIndex++;
                await showWechatStep();
            }
        }
        
        // ==================== 结局系统 ====================
        const endingTexts = {
            'hero-victory': [
                '你猛地睁开眼睛。',
                '阳光从窗帘缝隙洒进来，宿舍里安安静静。',
                '原来……是一场梦啊。',
                '但不得不说，骂得真爽。',
                '虽然梦是假的，但爽是真的。',
                '今天是12月7日——'
            ],
            'hero-quiet': [
                '你猛地睁开眼睛。',
                '阳光从窗帘缝隙洒进来，宿舍里安安静静。',
                '原来……是一场梦啊。',
                '但不得不说，不搭理他真爽。',
                '虽然梦是假的，但爽是真的。',
                '今天是12月7日——'
            ],
            'hero-sleep': [
                '你舒服地翻了个身，沉沉睡去。',
                '再次醒来，已经是中午。',
                '阳光明媚，周末大好。',
                '没有电话，没有PPT，只有惬意的休息。',
                '今天是12月7日——'
            ],
            'reality': [
                '你盯着熟悉的帘子。',
                '手机安静地躺在枕边。',
                '没有电话，没有PPT。',
                '原来……是一场梦啊。',
                '虽然在梦里也被CPU了，但那都是假的。',
                '嘿，今天是你生日，开心一点吧。'
            ]
        };
        
        async function initEnding() {
            const container = $('endingTextContainer');
            const endingImage = $('endingImage');
            const birthdayTitle = $('birthdayTitle');
            const endingScreen = screens.ending;
            
            container.innerHTML = '';
            endingImage.classList.remove('pop-in');
            birthdayTitle.classList.remove('celebrate');
            endingImage.style.display = 'none';
            
            const texts = endingTexts[GameState.endingType] || endingTexts['hero-victory'];
            
            // 黑屏渐亮效果
            endingScreen.style.background = '#000';
            await delay(1500);
            endingScreen.style.transition = 'background 2s ease';
            endingScreen.style.background = 'linear-gradient(180deg, #1a1a2e 0%, #2d2d44 100%)';
            
            // 显示配图（猛人线显示睁眼图片，睡觉和现实线不显示）
            if (['hero-victory', 'hero-quiet'].includes(GameState.endingType)) {
                endingImage.src = IMAGES.wakeup;
                endingImage.style.display = 'block';
                await delay(500);
                endingImage.classList.add('pop-in');
            }
            
            await delay(1000);
            
            // 逐行显示文字
            for (const text of texts) {
                const p = document.createElement('p');
                p.className = 'ending-text';
                p.textContent = text;
                container.appendChild(p);
                
                await delay(100);
                p.classList.add('fade-in');
                await delay(2200);
            }
            
            // 显示生日祝福
            await delay(1200);
            
            // 背景变成温暖的颜色
            endingScreen.style.background = 'linear-gradient(180deg, #FFFBF8 0%, #FFCCB6 50%, #ffecd2 100%)';
            
            // 播放音乐
            bgm.play().catch(() => {});
            audioToggle.classList.add('visible');
            
            // 礼花效果
            createConfetti();
            const confettiInterval = setInterval(createConfetti, 2500);
            
            // 清除之前的文字
            await delay(500);
            container.innerHTML = '';
            
            // 显示生日图片
            endingImage.src = IMAGES.birthday;
            endingImage.style.display = 'block';
            endingImage.classList.remove('pop-in');
            await delay(100);
            endingImage.classList.add('pop-in');
            
            await delay(600);
            
            // 显示生日标题
            birthdayTitle.textContent = '付QQ，生日快乐！！！';
            birthdayTitle.classList.add('celebrate');
            
            // 添加副标题
            await delay(1000);
            const subtitle = document.createElement('p');
            subtitle.className = 'ending-text';
            subtitle.style.fontSize = '1rem';
            subtitle.style.marginTop = '15px';
            subtitle.textContent = '🎂 愿你天天开心，永远幸福 🎂';
            container.appendChild(subtitle);
            await delay(100);
            subtitle.classList.add('fade-in');
        }
        
        // ==================== 音频控制 ====================
        audioToggle.addEventListener('click', () => {
            GameState.audioEnabled = !GameState.audioEnabled;
            const icon = audioToggle.querySelector('i');
            
            if (GameState.audioEnabled) {
                icon.className = 'fas fa-volume-up';
                bgm.play().catch(() => {});
            } else {
                icon.className = 'fas fa-volume-mute';
                bgm.pause();
            }
        });
        
        // ==================== 初始化 ====================
        async function init() {
            // 预加载图片
            await preloadImages();
            
            // 隐藏加载动画
            $('loading').classList.add('hidden');
            
            // 开始登录流程
            initLogin();
        }
        
        // 页面加载完成后初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>